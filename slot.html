<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alliance Slot - Wings of Fire</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            margin: 0; height: 100vh; 
            background: radial-gradient(circle at center, #3a1c52 0%, #1a0b2e 60%, #05020a 100%); 
            display: flex; justify-content: center; align-items: center; 
            font-family: 'Cinzel', serif; overflow: hidden; color: #d4af37; 
            transform: scale(0.9);
        }

        .slot-card { 
            position: relative; 
            width: 90%; 
            max-width: 450px; 
            height: 700px;
            max-height: 90vh;
            padding: 40px 30px;
            background: linear-gradient(180deg, rgba(30, 15, 40, 0.95) 0%, rgba(10, 5, 20, 0.98) 100%); 
            border: 3px solid #d4af37; border-radius: 20px; text-align: center; 
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.1), inset 0 0 40px rgba(0,0,0,0.8); 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .slot-card::before, .slot-card::after { content: ''; position: absolute; width: 15px; height: 15px; border: 3px solid #d4af37; pointer-events: none; z-index: 20; }
        .slot-card::before { top: 8px; left: 8px; border-right: none; border-bottom: none; } 
        .slot-card::after { bottom: 8px; right: 8px; border-left: none; border-top: none; }

        .slot-title { 
            font-size: 1.6rem; color: #ffd700; 
            text-transform: uppercase; letter-spacing: 3px; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8); 
            margin-bottom: 15px;
            margin-top: 45px;
        }

        .slot-reels { 
            display: flex; justify-content: center; gap: 15px; 
            margin-bottom: 20px; 
        }

        .reel { 
            width: 90px; height: 90px; 
            background: rgba(0, 0, 0, 0.5); 
            border: 3px solid #d4af37; border-radius: 15px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 3rem; 
            box-shadow: inset 0 0 20px rgba(0,0,0,0.6), 0 5px 15px rgba(0,0,0,0.5); 
            transition: all 0.3s; 
        }

        .reel.spinning { 
            animation: reelSpin 0.1s linear infinite; 
        }

        @keyframes reelSpin { 
            0%, 100% { transform: translateY(0) scale(1); } 
            50% { transform: translateY(-8px) scale(1.05); } 
        }

        .slot-result { 
            color: #ffd700; font-size: 1rem; 
            text-align: center; min-height: 40px; 
            margin-bottom: 15px; font-weight: bold; 
            line-height: 1.4; 
        }

        .spin-btn { 
            background: linear-gradient(135deg, #d4af37 0%, #8a6e2f 100%); 
            color: #1a0b2e; border: none; 
            padding: 15px 40px; border-radius: 12px; 
            cursor: pointer; font-family: 'Cinzel', serif; 
            font-size: 1.2rem; font-weight: bold; 
            text-transform: uppercase; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); 
            transition: all 0.2s; 
            width: 100%; 
        }

        .spin-btn:hover { 
            transform: scale(1.05); 
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4); 
        }

        .spin-btn:active { 
            transform: scale(0.98); 
        }

        .spin-btn:disabled { 
            opacity: 0.5; cursor: not-allowed; 
        }
        
        /* Auto Roll Button */
        .auto-roll-container {
            display: flex;
            gap: 10px;
            width: 100%;
            margin-top: 15px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .auto-roll-container.unlocked {
            opacity: 1;
            pointer-events: auto;
        }
        
        .auto-roll-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #d44000 100%);
            color: #fff;
            border: 2px solid #ff8c52;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: all 0.2s;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .auto-roll-btn.active {
            background: linear-gradient(135deg, #f44336 0%, #b71c1c 100%);
            border-color: #ff5252;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        
        .auto-roll-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }
        
        .auto-roll-btn:active {
            transform: scale(0.98);
        }
        
        .auto-roll-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Level Up Button */
        .level-up-container {
            display: none;
            width: 100%;
            margin-top: 15px;
        }
        
        .level-up-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            color: #1a0b2e;
            border: 3px solid #ffe57f;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.4);
            transition: all 0.2s;
            width: 100%;
            animation: levelUpPulse 1.5s infinite;
        }
        
        @keyframes levelUpPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 8px 20px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 10px 25px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.6); }
        }
        
        .level-up-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.6);
        }
        
        .level-up-btn:active {
            transform: scale(0.98);
        }

        .info-text { 
            color: #888; font-size: 0.85rem; 
            margin-top: 30px; line-height: 1.6; 
        }
        
        .points-container {
            background: rgba(10, 5, 15, 0.6);
            border: 2px solid #8a6e2f;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .points-label {
            color: #d4af37;
            font-size: 0.9rem;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }
        
        .points-value {
            color: #ffd700;
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .bet-info {
            color: #888;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .reset-btn {
            background: rgba(68, 68, 68, 0.8);
            border: 1px solid #666;
            color: #aaa;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 0.75rem;
            margin-top: 10px;
            transition: all 0.2s;
        }
        
        .reset-btn:hover {
            background: rgba(100, 100, 100, 0.8);
            color: #fff;
        }
        
        .points-value.positive {
            animation: pointsUp 0.3s ease-out;
        }
        
        .points-value.negative {
            animation: pointsDown 0.3s ease-out;
        }
        
        @keyframes pointsUp {
            0% { transform: scale(1); color: #4caf50; }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); color: #ffd700; }
        }
        
        @keyframes pointsDown {
            0% { transform: scale(1); color: #f44336; }
            50% { transform: scale(0.8); }
            100% { transform: scale(1); color: #ffd700; }
        }

        .legend { 
            margin-top: 20px; padding-top: 20px; 
            border-top: 1px solid rgba(212, 175, 55, 0.3); 
        }

        .legend-title { 
            color: #d4af37; font-size: 0.9rem; 
            margin-bottom: 5px; 
            margin-top: 10px;
            letter-spacing: 2px; 
        }

        .legend-item { 
            color: #aaa; font-size: 0.8rem; 
            margin: 3px 0;
            line-height: 1.3;
        }
        
        /* Fire Overlay */
        #fireOverlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(to top, rgba(50, 0, 0, 1) 0%, rgba(255, 50, 0, 0.8) 40%, rgba(255, 150, 0, 0.4) 70%, transparent 100%); 
            z-index: 999; 
            transform: translateY(100%); 
            opacity: 0;
            pointer-events: none; 
            mix-blend-mode: screen; 
            border-radius: 20px;
        }
        
        .animate-fire { 
            animation: fireRise 0.9s ease-in-out forwards; 
        } 
        
        @keyframes fireRise { 
            0% { transform: translateY(110%); opacity: 0; } 
            20% { opacity: 1; } 
            50% { transform: translateY(0%); opacity: 1; } 
            80% { opacity: 1; }
            100% { transform: translateY(-110%); opacity: 0; } 
        }
        
        /* Level Display */
        .level-display {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 0.9rem;
            color: #ffd700;
            font-weight: bold;
            letter-spacing: 1px;
            z-index: 10;
        }
        
        /* Back Button */
        .back-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            color: #d4af37;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.2s;
            z-index: 10;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: scale(1.05);
        }
        
        /* Info Button */
        .info-btn {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 35px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #d4af37;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #ffd700;
            font-size: 1.1rem;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            font-style: normal;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .info-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateX(-50%);
        }
        
        /* Info Modal */
        #infoModal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        #infoModal.show {
            display: flex;
        }
        
        .info-modal-content {
            position: relative;
            width: calc(90% - 10px);
            max-width: 440px;
            max-height: min(690px, calc(90vh - 10px));
            background: linear-gradient(180deg, rgba(30, 15, 40, 0.98) 0%, rgba(10, 5, 20, 0.98) 100%);
            border: 3px solid #d4af37;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.3), inset 0 0 40px rgba(0,0,0,0.8);
            animation: modalFadeIn 0.3s ease-out;
            overflow-y: auto;
            box-sizing: border-box;
        }
        
        .info-modal-content::before, .info-modal-content::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            border: 3px solid #d4af37;
            pointer-events: none;
            z-index: 1;
        }
        
        .info-modal-content::before {
            top: 8px;
            left: 8px;
            border-right: none;
            border-bottom: none;
        }
        
        .info-modal-content::after {
            bottom: 8px;
            right: 8px;
            border-left: none;
            border-top: none;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .info-modal-title {
            font-size: 1.4rem;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .close-modal-btn {
            background: linear-gradient(135deg, #d4af37 0%, #8a6e2f 100%);
            color: #1a0b2e;
            border: none;
            padding: 12px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            width: 100%;
            margin-top: 20px;
            transition: all 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .close-modal-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Info Modal -->
    <div id="infoModal">
        <div class="info-modal-content">
            <div class="info-modal-title">üìä GAME INFO ÔøΩ</div>
            
            <div class="legend" id="levelInfoContent">
                <!-- Level-specific info will be injected here -->
            </div>
            
            <div class="legend">
                <div class="legend-title">PAYTABLE</div>
                <div class="legend-item">üêâüêâüêâ = x30 (150)</div>
                <div class="legend-item">üêùüêùüêù / ü¶ìü¶ìü¶ì = x15 (75)</div>
                <div class="legend-item">üêâüêâ + BEE/ZOO = x10 (50)</div>
                <div class="legend-item">üêùüêùüêâ / ü¶ìü¶ìüêâ = x2 (10)</div>
                <div class="legend-item">üêù + ü¶ì = Bet returned (5)</div>
                <div class="legend-item">üëπ = -5</div>
                <div class="legend-item" style="color: #ff9800;">üëπüëπ = -12</div>
                <div class="legend-item" style="color: #ff5252;">üëπüëπüëπ = -30 (DANGER!)</div>
            </div>
            
            <div class="legend">
                <div class="legend-title">AUTO-ROLL FEATURE</div>
                <div class="legend-item">‚ö° Unlocks after 50 spins per level</div>
                <div class="legend-item">‚ñ∂Ô∏è Press to start continuous spins</div>
                <div class="legend-item">‚ùå Press again to stop anytime</div>
                <div class="legend-item">üîÑ Resets when leveling up</div>
            </div>
            
            <button class="close-modal-btn" onclick="closeInfoModal()">CLOSE</button>
        </div>
    </div>
    
    <!-- Reset Confirmation Modal -->
    <div id="resetModal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(5px);">
        <div style="position: relative; width: calc(90% - 10px); max-width: 440px; max-height: min(690px, calc(90vh - 10px)); background: linear-gradient(180deg, rgba(30, 15, 40, 0.98) 0%, rgba(10, 5, 20, 0.98) 100%); border: 3px solid #d4af37; border-radius: 20px; padding: 30px; box-shadow: 0 0 50px rgba(212, 175, 55, 0.3), inset 0 0 40px rgba(0,0,0,0.8); text-align: center; box-sizing: border-box;">
            <div style="font-size: 1.2rem; color: #ffd700; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px;">‚ö†Ô∏è RESET GAME ‚ö†Ô∏è</div>
            <div style="color: #fff; font-size: 1rem; margin-bottom: 20px; line-height: 1.6;">
                You will start at<br>
                <span style="color: #ffd700; font-size: 1.2rem; font-weight: bold;">LEVEL 1</span><br>
                with<br>
                <span style="color: #ffd700; font-size: 1.2rem; font-weight: bold;">100 CREDITS</span>
            </div>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button onclick="confirmReset()" style="flex: 1; background: linear-gradient(180deg, #d4af37 0%, #96732b 100%); border: 2px solid #d4af37; color: #000; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem;">YES</button>
                <button onclick="cancelReset()" style="flex: 1; background: #444; border: 2px solid #888; color: #fff; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem;">NO</button>
            </div>
        </div>
    </div>
    
    <div class="slot-card">
        <div id="fireOverlay"></div>
        <div class="level-display" id="levelDisplay">LEVEL 1</div>
        <a href="index.html" class="back-btn" id="backBtn">
            <span>‚Üê</span>
            <span>BACK</span>
        </a>
        <div class="info-btn" onclick="openInfoModal()" title="Game Info">‚ùî</div>
        <div class="slot-title">üé∞ ALLIANCE SLOT üé∞</div>
        
        <div class="points-container">
            <div class="points-label">CREDITS</div>
            <div class="points-value" id="pointsDisplay">100</div>
            <div class="bet-info">BET: 5 credits per spin</div>
            <button class="reset-btn" onclick="resetGame()">RESET GAME</button>
        </div>
        
        <div class="slot-reels">
            <div class="reel" id="reel1">üêâ</div>
            <div class="reel" id="reel2">üêù</div>
            <div class="reel" id="reel3">ü¶ì</div>
        </div>
        
        <div class="slot-result" id="result"></div>
        
        <button class="spin-btn" id="spinBtn" onclick="spin()">üé≤ SPIN</button>
        
        <div class="auto-roll-container" id="autoRollContainer">
            <button class="auto-roll-btn" id="autoRollBtn" onclick="toggleAutoRoll()">‚ñ∂Ô∏è AUTO-ROLL</button>
        </div>
        
        <div class="level-up-container" id="levelUpBtn">
            <button class="level-up-btn" onclick="triggerLevelUp()">‚¨ÜÔ∏è LEVEL UP ‚¨ÜÔ∏è</button>
        </div>
        
        <div class="info-text">
            Wings of Fire Alliance<br>
            üêâ DRAGON ‚Ä¢ üêù BEE ‚Ä¢ ü¶ì ZOO
        </div>
    </div>

    <script>
        // Level system with progressive difficulty
        let currentLevel = parseInt(localStorage.getItem('slotLevel')) || 1;
        const WIN_TARGET = 1000;
        const MAX_LEVEL = 5;
        const AUTO_ROLL_UNLOCK_SPINS = 50; // Unlock auto-roll after 50 spins
        let spinsInLevel = parseInt(localStorage.getItem('slotSpins')) || 0;
        let isAutoRolling = false;
        let autoRollInterval = null;
        let canLevelUp = false; // Player reached 1000 and can level up
        
        // Base weights that change per level
        function getSymbolWeights() {
            const difficultyMultiplier = 1 + (currentLevel - 1) * 0.2; // 20% more ROS per level
            return [
                { symbol: "üêâ", weight: Math.max(1.2, 3.5 - (currentLevel - 1) * 0.3) }, // Dragon starts high, decreases
                { symbol: "üêù", weight: 2.8 },
                { symbol: "ü¶ì", weight: 2.8 },
                { symbol: "üëπ", weight: Math.max(1, 1.5 * difficultyMultiplier) } // ROS starts low, increases per level
            ];
        }
        
        let symbolWeights = getSymbolWeights();
        let totalWeight = symbolWeights.reduce((sum, s) => sum + s.weight, 0);
        
        function getWeightedSymbol() {
            let random = Math.random() * totalWeight;
            for (let item of symbolWeights) {
                if (random < item.weight) {
                    return item.symbol;
                }
                random -= item.weight;
            }
            return symbolWeights[0].symbol;
        }
        
        let isSpinning = false;
        let spinInterval = null;
        const BET_AMOUNT = 5;
        const INITIAL_CREDITS = 100;
        let points = parseInt(localStorage.getItem('slotPoints')) || INITIAL_CREDITS;
        
        // Update points display on load
        document.addEventListener('DOMContentLoaded', () => {
            // Update back button URL based on context
            const urlParams = new URLSearchParams(window.location.search);
            const from = urlParams.get('from');
            const backBtn = document.getElementById('backBtn');
            
            if (from === 'alliance') {
                backBtn.href = 'index.html#alliance';
            } else if (from === 'edit') {
                backBtn.href = 'index.html#edit';
            } else {
                backBtn.href = 'index.html';
            }
            
            updateDisplay();
            updateLevelDisplay();
            
            // Restore auto-roll unlock state if applicable
            if (spinsInLevel >= AUTO_ROLL_UNLOCK_SPINS) {
                const container = document.getElementById('autoRollContainer');
                container.classList.add('unlocked');
            }
        });
        
        function updateLevelDisplay() {
            document.getElementById('levelDisplay').textContent = `LEVEL ${currentLevel}`;
        }
        
        function showLevelUpButton() {
            const autoRollContainer = document.getElementById('autoRollContainer');
            const levelUpBtn = document.getElementById('levelUpBtn');
            
            // Hide auto-roll button
            autoRollContainer.style.display = 'none';
            
            // Show level up button
            levelUpBtn.style.display = 'flex';
        }
        
        function hideLevelUpButton() {
            const autoRollContainer = document.getElementById('autoRollContainer');
            const levelUpBtn = document.getElementById('levelUpBtn');
            
            // Show auto-roll button again
            autoRollContainer.style.display = 'flex';
            
            // Hide level up button
            levelUpBtn.style.display = 'none';
        }
        
        function triggerLevelUp() {
            if (!canLevelUp) return;
            canLevelUp = false;
            hideLevelUpButton();
            levelUp();
        }
        
        function checkAutoRollUnlock() {
            const container = document.getElementById('autoRollContainer');
            if (spinsInLevel >= AUTO_ROLL_UNLOCK_SPINS && !container.classList.contains('unlocked')) {
                container.classList.add('unlocked');
                const result = document.getElementById('result');
                const prevText = result.textContent;
                result.textContent = '‚ö° AUTO-ROLL UNLOCKED! ‚ö°';
                result.style.color = '#ff6b35';
                setTimeout(() => {
                    if (result.textContent.includes('AUTO-ROLL')) {
                        result.textContent = prevText;
                    }
                }, 2000);
            }
        }
        
        function toggleAutoRoll() {
            if (isAutoRolling) {
                // Stop auto-roll
                isAutoRolling = false;
                if (autoRollInterval) {
                    clearTimeout(autoRollInterval);
                    autoRollInterval = null;
                }
                const btn = document.getElementById('autoRollBtn');
                btn.classList.remove('active');
                btn.innerHTML = '‚ñ∂Ô∏è AUTO-ROLL';
            } else {
                // Start auto-roll
                isAutoRolling = true;
                const btn = document.getElementById('autoRollBtn');
                btn.classList.add('active');
                btn.innerHTML = '‚ùå STOP';
                autoRollCycle();
            }
        }
        
        function autoRollCycle() {
            if (!isAutoRolling) return;
            
            // Check if we have enough credits
            if (points < BET_AMOUNT) {
                isAutoRolling = false;
                const btn = document.getElementById('autoRollBtn');
                btn.classList.remove('active');
                btn.innerHTML = '‚ñ∂Ô∏è AUTO-ROLL';
                return;
            }
            
            // Trigger spin
            spin();
            
            // Schedule next spin (wait for current spin to finish + small delay)
            autoRollInterval = setTimeout(() => {
                autoRollCycle();
            }, 1500); // 1.5 seconds between auto-spins
        }
        
        function openInfoModal() {
            updateModalLevelInfo();
            // Push a history state so back button closes modal
            window.history.pushState({ modalOpen: true }, '');
            document.getElementById('infoModal').classList.add('show');
        }
        
        function updateModalLevelInfo() {
            const levelInfoDiv = document.getElementById('levelInfoContent');
            let levelInfo = '';
            
            switch(currentLevel) {
                case 1:
                    levelInfo = `
                        <div class="legend-title">LEVEL 1 - BEGINNER</div>
                        <div class="legend-item">üéØ Reach 1000 to advance to Level 2</div>
                        <div class="legend-item">‚úÖ Easiest difficulty - High Dragon rate</div>
                        <div class="legend-item">üö® If you lose all credits: Restart at 100 in Level 1</div>
                    `;
                    break;
                case 2:
                    levelInfo = `
                        <div class="legend-title">LEVEL 2 - INTERMEDIATE</div>
                        <div class="legend-item">üéØ Reach 1000 to advance to Level 3</div>
                        <div class="legend-item">üìà Medium difficulty - Balanced odds</div>
                        <div class="legend-item">üö® If you lose all credits: Restart at 100 in Level 2</div>
                    `;
                    break;
                case 3:
                    levelInfo = `
                        <div class="legend-title">LEVEL 3 - ADVANCED</div>
                        <div class="legend-item">üéØ Reach 1000 to advance to Level 4</div>
                        <div class="legend-item">‚ö†Ô∏è Hard difficulty - More ROS appearing</div>
                        <div class="legend-item">üö® If you lose all credits: Fall back to Level 2</div>
                    `;
                    break;
                case 4:
                    levelInfo = `
                        <div class="legend-title">LEVEL 4 - EXPERT</div>
                        <div class="legend-item">üéØ Reach 1000 to unlock FINAL LEVEL</div>
                        <div class="legend-item">üî• Very hard - Dragon rate decreased</div>
                        <div class="legend-item">üö® If you lose all credits: Fall back to Level 2</div>
                    `;
                    break;
                case 5:
                    levelInfo = `
                        <div class="legend-title">LEVEL 5 - FINAL BOSS üíÄ</div>
                        <div class="legend-item">üèÜ MAXIMUM LEVEL - Ultimate Challenge!</div>
                        <div class="legend-item">‚ò†Ô∏è EXTREME difficulty - Highest ROS rate</div>
                        <div class="legend-item">üö® If you lose all credits: RESTART FROM LEVEL 1!</div>
                        <div class="legend-item">‚ôªÔ∏è Reach 1000 to restart at Level 5 again</div>
                    `;
                    break;
            }
            
            levelInfoDiv.innerHTML = levelInfo;
        }
        
        function closeInfoModal() {
            const modalElement = document.getElementById('infoModal');
            // Only close if modal is actually open
            if (modalElement.classList.contains('show')) {
                modalElement.classList.remove('show');
            }
        }
        
        function levelUp() {
            // Check if already at max level
            if (currentLevel >= MAX_LEVEL) {
                // Stay at level 5, reset to 100 credits
                points = 100;
                spinsInLevel = 0;
                canLevelUp = false;
                localStorage.setItem('slotPoints', points);
                localStorage.setItem('slotLevel', currentLevel);
                localStorage.setItem('slotSpins', spinsInLevel);
                updateDisplay();
                
                const result = document.getElementById('result');
                result.textContent = 'üèÜ LEVEL 5 COMPLETED!\nRestarting at Level 5...\nYou are a CHAMPION!';
                result.style.color = '#ffd700';
                playWinSound();
                
                // Reset auto-roll
                if (isAutoRolling) {
                    isAutoRolling = false;
                    if (autoRollInterval) {
                        clearTimeout(autoRollInterval);
                        autoRollInterval = null;
                    }
                }
                const container = document.getElementById('autoRollContainer');
                container.classList.remove('unlocked');
                const btn = document.getElementById('autoRollBtn');
                btn.classList.remove('active');
                btn.innerHTML = '‚ñ∂Ô∏è AUTO-ROLL';
                return;
            }
            
            currentLevel++;
            canLevelUp = false;
            
            // Stop auto-roll if active
            if (isAutoRolling) {
                isAutoRolling = false;
                if (autoRollInterval) {
                    clearTimeout(autoRollInterval);
                    autoRollInterval = null;
                }
            }
            
            // Fire transition
            const fireOverlay = document.getElementById('fireOverlay');
            fireOverlay.classList.remove('animate-fire');
            void fireOverlay.offsetWidth;
            fireOverlay.classList.add('animate-fire');
            playFireSound();
            
            // Update weights for new difficulty
            symbolWeights = getSymbolWeights();
            totalWeight = symbolWeights.reduce((sum, s) => sum + s.weight, 0);
            
            setTimeout(() => {
                // Reset to 100 credits for new level
                points = 100;
                spinsInLevel = 0; // Reset spin counter
                localStorage.setItem('slotPoints', points);
                localStorage.setItem('slotLevel', currentLevel);
                localStorage.setItem('slotSpins', spinsInLevel);
                updateDisplay();
                updateLevelDisplay();
                
                // Reset auto-roll button
                const container = document.getElementById('autoRollContainer');
                container.classList.remove('unlocked');
                const btn = document.getElementById('autoRollBtn');
                btn.classList.remove('active');
                btn.innerHTML = '‚ñ∂Ô∏è AUTO-ROLL';
                
                const result = document.getElementById('result');
                result.textContent = `üî• LEVEL ${currentLevel} UNLOCKED! üî•\nDifficulty Increased!\nGood Luck!`;
                result.style.color = '#ff4500';
                
                // Auto-open info modal to show new level rules
                setTimeout(() => openInfoModal(), 1000);
            }, 450);
        }
        
        function updateDisplay() {
            const display = document.getElementById('pointsDisplay');
            display.textContent = points;
            
            // Check if player lost all credits
            if (points <= 0 && !isSpinning) {
                handleLevelLoss();
                return;
            }
            
            // Disable button if not enough credits
            const btn = document.getElementById('spinBtn');
            if (points < BET_AMOUNT) {
                btn.disabled = true;
                btn.textContent = 'NOT ENOUGH CREDITS';
            } else {
                btn.disabled = false;
                btn.textContent = 'üé≤ SPIN';
            }
        }
        
        function handleLevelLoss() {
            // Stop auto-roll if active
            if (isAutoRolling) {
                isAutoRolling = false;
                if (autoRollInterval) {
                    clearTimeout(autoRollInterval);
                    autoRollInterval = null;
                }
                const autoBtn = document.getElementById('autoRollBtn');
                autoBtn.classList.remove('active');
                autoBtn.innerHTML = '‚ñ∂Ô∏è AUTO-ROLL';
            }
            
            // Hide level up button if showing
            if (canLevelUp) {
                hideLevelUpButton();
                canLevelUp = false;
            }
            
            let newLevel = currentLevel;
            let message = '';
            
            switch(currentLevel) {
                case 1:
                    // Level 1: Stay at level 1, reset to 100
                    newLevel = 1;
                    message = 'üíÄ GAME OVER!\nRestarting Level 1...';
                    break;
                case 2:
                    // Level 2: Stay at level 2, reset to 100
                    newLevel = 2;
                    message = 'üíÄ OUT OF CREDITS!\nRestarting Level 2...';
                    break;
                case 3:
                    // Level 3: Fall back to level 2
                    newLevel = 2;
                    message = 'üíÄ LEVEL LOST!\nFalling back to Level 2...';
                    break;
                case 4:
                    // Level 4: Fall back to level 2
                    newLevel = 2;
                    message = 'üíÄ LEVEL LOST!\nFalling back to Level 2...';
                    break;
                case 5:
                    // Level 5: Fall back to level 1 (complete reset)
                    newLevel = 1;
                    message = 'üíÄ FINAL LEVEL FAILED!\nRestarting from Level 1...';
                    break;
            }
            
            const result = document.getElementById('result');
            result.textContent = message;
            result.style.color = '#ff0000';
            
            setTimeout(() => {
                currentLevel = newLevel;
                points = 100;
                spinsInLevel = 0;
                symbolWeights = getSymbolWeights();
                totalWeight = symbolWeights.reduce((sum, s) => sum + s.weight, 0);
                localStorage.setItem('slotPoints', points);
                localStorage.setItem('slotLevel', currentLevel);
                localStorage.setItem('slotSpins', spinsInLevel);
                updateDisplay();
                updateLevelDisplay();
                
                // Reset auto-roll UI
                const container = document.getElementById('autoRollContainer');
                container.classList.remove('unlocked');
                
                result.textContent = 'Ready to try again!';
                result.style.color = '#ffd700';
            }, 2000);
        }
        
        function updatePoints(change, animate = true) {
            const oldPoints = points;
            points += change;
            if (points < 0) points = 0;
            localStorage.setItem('slotPoints', points);
            const display = document.getElementById('pointsDisplay');
            display.textContent = points;
            
            if (animate) {
                if (change > 0) {
                    display.classList.remove('negative');
                    display.classList.add('positive');
                } else if (change < 0) {
                    display.classList.remove('positive');
                    display.classList.add('negative');
                }
                
                setTimeout(() => {
                    display.classList.remove('positive', 'negative');
                }, 300);
            }
            
            // Check if player reached level target
            if (oldPoints < WIN_TARGET && points >= WIN_TARGET && !canLevelUp) {
                canLevelUp = true;
                
                // Stop auto-roll immediately
                if (isAutoRolling) {
                    isAutoRolling = false;
                    if (autoRollInterval) {
                        clearTimeout(autoRollInterval);
                        autoRollInterval = null;
                    }
                    const autoBtn = document.getElementById('autoRollBtn');
                    autoBtn.classList.remove('active');
                    autoBtn.innerHTML = '‚ñ∂Ô∏è AUTO-ROLL';
                }
                
                // Play fanfare
                setTimeout(() => {
                    playFanfareSound();
                    
                    const result = document.getElementById('result');
                    if (currentLevel >= MAX_LEVEL) {
                        result.textContent = 'üèÜ 1000 REACHED!\nYou completed Level 5!\nKeep spinning or reset!';
                    } else {
                        result.textContent = 'üèÜ 1000 REACHED!\nReady to advance!\nPress LEVEL UP or keep spinning!';
                        showLevelUpButton();
                    }
                    result.style.color = '#ffd700';
                }, 200);
            }
            
            updateDisplay();
        }
        
        function resetGame() {
            document.getElementById('resetModal').style.display = 'flex';
        }
        
        function confirmReset() {
            document.getElementById('resetModal').style.display = 'none';
            currentLevel = 1;
            spinsInLevel = 0;
            isAutoRolling = false;
            canLevelUp = false;
            if (autoRollInterval) {
                clearTimeout(autoRollInterval);
                autoRollInterval = null;
            }
            symbolWeights = getSymbolWeights();
            totalWeight = symbolWeights.reduce((sum, s) => sum + s.weight, 0);
            points = INITIAL_CREDITS;
            localStorage.setItem('slotPoints', points);
            updateDisplay();
            updateLevelDisplay();
            document.getElementById('result').textContent = '';
        }
        
        function cancelReset() {
            document.getElementById('resetModal').style.display = 'none';
        }

        // Web Audio API para generar sonidos
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playBeep(frequency, duration, type = 'sine') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playFireSound() {
            // Fire sound effect
            const t = audioContext.currentTime;
            const noise = audioContext.createOscillator();
            const filter = audioContext.createBiquadFilter();
            const gain = audioContext.createGain();
            
            noise.type = 'sawtooth';
            noise.frequency.setValueAtTime(100, t);
            noise.frequency.linearRampToValueAtTime(800, t + 0.4);
            noise.frequency.linearRampToValueAtTime(100, t + 1.2);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(200, t);
            filter.frequency.linearRampToValueAtTime(1000, t + 0.5);
            
            gain.gain.setValueAtTime(0, t);
            gain.gain.linearRampToValueAtTime(0.3, t + 0.2);
            gain.gain.linearRampToValueAtTime(0, t + 1.2);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioContext.destination);
            
            noise.start(t);
            noise.stop(t + 1.2);
        }
        
        function playFanfareSound() {
            // Victory fanfare - triumphant melody
            const t = audioContext.currentTime;
            const notes = [
                { freq: 523, start: 0, duration: 0.15 },      // C5
                { freq: 659, start: 0.15, duration: 0.15 },   // E5
                { freq: 784, start: 0.3, duration: 0.15 },    // G5
                { freq: 1047, start: 0.45, duration: 0.4 }    // C6 (held)
            ];
            
            notes.forEach(note => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.type = 'triangle';
                osc.frequency.value = note.freq;
                
                const startTime = t + note.start;
                const endTime = startTime + note.duration;
                
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.25, startTime + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.01, endTime);
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.start(startTime);
                osc.stop(endTime);
            });
        }

        function startSpinSound() {
            if (spinInterval) return;
            let tick = 0;
            spinInterval = setInterval(() => {
                // Alternating lower frequencies for a softer mechanical sound
                const freq = (tick % 2 === 0) ? 180 : 150;
                playBeep(freq, 0.03, 'sine');
                tick++;
            }, 120);
        }

        function stopSpinSound() {
            if (spinInterval) {
                clearInterval(spinInterval);
                spinInterval = null;
            }
        }

        function playWinSound() {
            playBeep(523, 0.15);
            setTimeout(() => playBeep(659, 0.15), 150);
            setTimeout(() => playBeep(784, 0.3), 300);
        }

        function playFireSound() {
            playBeep(440, 0.2);
            setTimeout(() => playBeep(554, 0.2), 100);
        }

        function playBadSound() {
            playBeep(200, 0.2, 'sawtooth');
            setTimeout(() => playBeep(150, 0.3, 'sawtooth'), 150);
        }

        function playTryAgainSound() {
            playBeep(350, 0.1, 'triangle');
        }

        function spin() {
            if (isSpinning) return;
            
            // Check if player has enough credits
            if (points < BET_AMOUNT) {
                alert('‚ö†Ô∏è Not enough credits! You need ' + BET_AMOUNT + ' credits to spin.');
                // Stop auto-roll if active
                if (isAutoRolling) {
                    isAutoRolling = false;
                    const btn = document.getElementById('autoRollBtn');
                    btn.classList.remove('active');
                    btn.innerHTML = '‚ñ∂Ô∏è AUTO-ROLL';
                }
                return;
            }
            
            isSpinning = true;
            spinsInLevel++; // Increment spin counter
            localStorage.setItem('slotSpins', spinsInLevel);
            
            // Deduct bet amount
            updatePoints(-BET_AMOUNT, false);

            const reel1 = document.getElementById('reel1');
            const reel2 = document.getElementById('reel2');
            const reel3 = document.getElementById('reel3');
            const result = document.getElementById('result');
            const btn = document.getElementById('spinBtn');

            btn.disabled = true;
            result.textContent = '';
            result.style.color = '#ffd700';

            // Start continuous spin sound
            startSpinSound();

            reel1.classList.add('spinning');
            reel2.classList.add('spinning');
            reel3.classList.add('spinning');

            let counter = 0;
            const interval = setInterval(() => {
                reel1.textContent = getWeightedSymbol();
                reel2.textContent = getWeightedSymbol();
                reel3.textContent = getWeightedSymbol();
                counter++;

                if (counter > 10) {
                    clearInterval(interval);
                    
                    // Stop spin sound
                    stopSpinSound();

                    const final1 = getWeightedSymbol();
                    const final2 = getWeightedSymbol();
                    const final3 = getWeightedSymbol();

                    reel1.textContent = final1;
                    reel2.textContent = final2;
                    reel3.textContent = final3;

                    reel1.classList.remove('spinning');
                    reel2.classList.remove('spinning');
                    reel3.classList.remove('spinning');

                    setTimeout(() => {
                        checkResult(final1, final2, final3);
                        checkAutoRollUnlock(); // Check if auto-roll should be unlocked
                        btn.disabled = false;
                        isSpinning = false;
                    }, 200);
                }
            }, 80);
        }

        function checkResult(r1, r2, r3) {
            const result = document.getElementById('result');
            
            // Contar cu√°ntos ROS aparecieron
            const rosCount = [r1, r2, r3].filter(r => r === 'üëπ').length;

            // Primero verificar ROS (1, 2 o 3 en cualquier posici√≥n)
            if (rosCount > 0) {
                let pointsLost;
                if (rosCount === 3) {
                    pointsLost = 30; // Triple ROS
                    result.textContent = `üíÄ TRIPLE ROS!\nYOU LOST -${pointsLost}! üíÄ`;
                } else if (rosCount === 2) {
                    pointsLost = 12; // Double ROS
                    result.textContent = `üëπüëπ DOUBLE ROS!\nYOU LOST -${pointsLost}! ‚ùå`;
                } else {
                    pointsLost = 5; // Single ROS
                    result.textContent = `üëπ ROS APPEARED...\nYOU LOST -${pointsLost}! ‚ùå`;
                }
                result.style.color = '#ff5252';
                playBadSound();
                updatePoints(-pointsLost);
            }
            // Triple Dragon
            else if (r1 === 'üêâ' && r2 === 'üêâ' && r3 === 'üêâ') {
                const win = BET_AMOUNT * 30; // Increased to 150
                result.textContent = `WINGS OF FIRE REIGNS!\n+${win}!`;
                result.style.color = '#ffd700';
                playWinSound();
                updatePoints(win);
            }
            // üêâüêâ + ü¶ì = Wild Victory
            else if ((r1 === 'üêâ' && r2 === 'üêâ' && r3 === 'ü¶ì') ||
                     (r1 === 'üêâ' && r3 === 'üêâ' && r2 === 'ü¶ì') ||
                     (r2 === 'üêâ' && r3 === 'üêâ' && r1 === 'ü¶ì')) {
                const win = BET_AMOUNT * 10; // Increased to 50
                result.textContent = `üêâüêâü¶ì WILD VICTORY!\n+${win}!`;
                result.style.color = '#8bc34a';
                playFireSound();
                updatePoints(win);
            }
            // üêâüêâ + üêù = Honey Victory
            else if ((r1 === 'üêâ' && r2 === 'üêâ' && r3 === 'üêù') ||
                     (r1 === 'üêâ' && r3 === 'üêâ' && r2 === 'üêù') ||
                     (r2 === 'üêâ' && r3 === 'üêâ' && r1 === 'üêù')) {
                const win = BET_AMOUNT * 10; // Increased to 50
                result.textContent = `üêâüêâüêù HONEY VICTORY!\n+${win}!`;
                result.style.color = '#ffeb3b';
                playFireSound();
                updatePoints(win);
            }
            // üêùüêù o ü¶ìü¶ì + üêâ = Small win
            else if ((r1 === 'üêù' && r2 === 'üêù' && r3 === 'üêâ') ||
                     (r1 === 'üêù' && r3 === 'üêù' && r2 === 'üêâ') ||
                     (r2 === 'üêù' && r3 === 'üêù' && r1 === 'üêâ') ||
                     (r1 === 'ü¶ì' && r2 === 'ü¶ì' && r3 === 'üêâ') ||
                     (r1 === 'ü¶ì' && r3 === 'ü¶ì' && r2 === 'üêâ') ||
                     (r2 === 'ü¶ì' && r3 === 'ü¶ì' && r1 === 'üêâ')) {
                const win = BET_AMOUNT * 2;
                result.textContent = `üêâ DRAGON BLESSING!\n+${win}!`;
                result.style.color = '#ff9800';
                playFireSound();
                updatePoints(win);
            }
            // Triple Bee o Triple Zoo
            else if (r1 === r2 && r2 === r3) {
                const win = BET_AMOUNT * 15; // Increased to 75
                if (r1 === 'üêù') {
                    result.textContent = `‚ú® TRIPLE BEE!\nALLIANCE STRONG!\n+${win}! ‚ú®`;
                    result.style.color = '#ffeb3b';
                } else if (r1 === 'ü¶ì') {
                    result.textContent = `‚ú® TRIPLE ZOO!\nWILD VICTORY!\n+${win}! ‚ú®`;
                    result.style.color = '#8bc34a';
                }
                playFireSound();
                updatePoints(win);
            }
            // üêù + ü¶ì = You get bet back
            else if ((r1 === 'üêù' || r2 === 'üêù' || r3 === 'üêù') && 
                     (r1 === 'ü¶ì' || r2 === 'ü¶ì' || r3 === 'ü¶ì')) {
                result.textContent = `üêùü¶ì BEE & ZOO!\nBET RETURNED!\n+${BET_AMOUNT}`;
                result.style.color = '#9e9e9e';
                playTryAgainSound();
                updatePoints(BET_AMOUNT);
            }
            // Resto = Lost
            else {
                result.textContent = 'NO WIN\nTRY AGAIN!';
                result.style.color = '#9e9e9e';
                playTryAgainSound();
                // Ya se dedujo el bet al inicio
            }
        }
        
        // === BACK BUTTON HANDLING ===
        window.addEventListener('popstate', (event) => {
            const infoModal = document.getElementById('infoModal');
            if (infoModal && infoModal.classList.contains('show')) {
                closeInfoModal();
            }
        });
    </script>
</body>
</html>
